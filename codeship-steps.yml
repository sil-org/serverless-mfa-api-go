- name: test
  service: test
  command: ./codeship/test.sh

- name: deploy
  service: app
  tag: ^(main|develop)
  command: ./codeship/deploy.sh

- name: track_deployment
  service: tracker
  tag: ^(main|develop)
  command: "true"

- name: push_develop
  service: app
  type: push
  image_name: silintl/serverless-mfa-api-go
  image_tag: "{{.Branch}}"
  exclude: main
  registry: https://index.docker.io/v1/
  encrypted_dockercfg_path: dockercfg.encrypted

- name: push_production
  service: app
  type: push
  image_name: silintl/serverless-mfa-api-go
  image_tag: "latest"
  tag: main
  registry: https://index.docker.io/v1/
  encrypted_dockercfg_path: dockercfg.encrypted

- name: ga4track_deployment
  service: ga4tracker
  tag: ^(main|develop)
  command: sh -c "export GA_EVENT_NAME=${CI_BRANCH}_serverless_mfa_api_go && ./ga-event-tracker"